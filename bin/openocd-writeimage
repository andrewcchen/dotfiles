#!/bin/bash

device=${0##*.}
if [[ $device != $0 ]]; then
	openocd=openocd.$device
else
	openocd=openocd
fi

if [[ -z $1 ]]; then
  echo "Usage: $0 <image file>"
  exit 1
fi

if [[ ! -e $1 ]]; then
  echo "ERROR: image file $1 does not exist"
  exit 1
fi

exec $openocd -c init -c targets -c halt -c "flash write_image erase $1" -c "verify_image $1" -c "reset run" -c shutdown
